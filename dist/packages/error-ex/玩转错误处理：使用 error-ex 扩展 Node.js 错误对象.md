---
title: ç©è½¬é”™è¯¯å¤„ç†ï¼šä½¿ç”¨ error-ex æ‰©å±• Node.js é”™è¯¯å¯¹è±¡
tags: [Node.js, error-ex, é”™è¯¯å¤„ç†]
desc: äº†è§£å¦‚ä½•ä½¿ç”¨ error-ex åŒ…æ¥å®šåˆ¶å’Œæ‰©å±• Node.js çš„é”™è¯¯å¯¹è±¡ï¼Œä¸ºé”™è¯¯å¤„ç†æ·»åŠ æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
pkgName: error-ex
---

# ç©è½¬é”™è¯¯å¤„ç†ï¼šä½¿ç”¨ error-ex æ‰©å±• Node.js é”™è¯¯å¯¹è±¡

é”™è¯¯å¤„ç†åœ¨ä»»ä½•ç¼–ç¨‹è¯­è¨€ä¸­éƒ½æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„ç¯èŠ‚ã€‚Node.js çš„ `Error` å¯¹è±¡æä¾›äº†åŸºæœ¬çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ›´å¤šå®šåˆ¶åŒ–åŠŸèƒ½ï¼Œä»¥å¢åŠ é”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯æˆ–æ”¹é€ é”™è¯¯çš„å±•ç¤ºã€‚è¿™ç¯‡æ–‡ç« å°†å‘ä½ ä»‹ç»å¦‚ä½•ä½¿ç”¨ `error-ex` åŒ…æ¥è¾¾æˆè¿™ä¸ªç›®çš„ã€‚

## ğŸ—‚ å¼€å§‹ä¹‹å‰çš„å‡†å¤‡

åœ¨å¼€å§‹ä¹‹å‰ï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº† `error-ex`ã€‚å¦‚æœè¿˜æœªå®‰è£…ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åŠ ä»¥å®‰è£…ï¼š

```bash
npm install error-ex --save
```

å®‰è£…å®Œæˆåï¼Œä½ å°±å¯ä»¥åœ¨ä½ çš„ Node.js é¡¹ç›®ä¸­ä½¿ç”¨ `error-ex`ã€‚

## ğŸš§ åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯ç±»å‹

`error-ex` çš„æ ¸å¿ƒåŠŸèƒ½åœ¨äºè®©ä½ èƒ½éå¸¸å®¹æ˜“åœ°åˆ›å»ºæ–°çš„é”™è¯¯ç±»å‹ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåä¸º `JSONError` çš„æ–°é”™è¯¯ç±»å‹ã€‚

```js
const errorEx = require('error-ex');

const JSONError = errorEx('JSONError');

const err = new JSONError('å‡ºç°é”™è¯¯');
err.name; //-> 'JSONError'
throw err; // æŠ›å‡ºçš„é”™è¯¯å°†ä¼šæ˜¾ç¤ºä¸º 'JSONError: å‡ºç°é”™è¯¯'
```

ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç‰¹å®šåç§°çš„é”™è¯¯ç±»å‹ï¼Œå¹¶é€šè¿‡ `new` å…³é”®å­—å®ä¾‹åŒ–è¯¥é”™è¯¯ï¼ŒåŒæ—¶ `err.name` å°†ä¼šæ˜¾ç¤ºæˆ‘ä»¬æ‰€è®¾å®šçš„é”™è¯¯åç§°ã€‚

## ğŸ” ç»™é”™è¯¯ä¿¡æ¯æ·»åŠ æ›´å¤šä¸Šä¸‹æ–‡

æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æŠ›å‡ºçš„é”™è¯¯ä¸­æ·»åŠ æ–‡ä»¶åã€è·¯å¾„æˆ–å…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚ä½¿ç”¨ `error-ex`ï¼Œä½ å¯ä»¥è½»æ˜“åœ°ä¸ºé”™è¯¯æ·»åŠ é¢å¤–çš„ä¸Šä¸‹æ–‡ã€‚

```js
const JSONError = errorEx('JSONError', { fileName: errorEx.line('åœ¨ %s ä¸­') });

const err = new JSONError('è§£æé”™è¯¯');
err.fileName = '/a/b/c/foo.json';
throw err; // æŠ›å‡ºçš„é”™è¯¯ç°åœ¨ä¼šåŒ…å«æ–‡ä»¶è·¯å¾„: '(line 2)-> åœ¨ /a/b/c/foo.json ä¸­'
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`fileName` å±æ€§è¢«ç”¨æ¥æ·»åŠ ä¸€ä¸ªæ ˆè¡Œï¼Œå®ƒä¸ºé”™è¯¯æä¾›äº†æ›´å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

## ğŸ›  è¿›é˜¶è‡ªå®šä¹‰é”™è¯¯å¤„ç†

`error-ex` ä¹Ÿå…è®¸ä½ é€šè¿‡ä¸€ä¸ªå¯é…ç½®çš„å±æ€§å­—å…¸æ¥æ„å»ºå¤æ‚çš„é”™è¯¯ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè¾ƒä¸ºé«˜çº§çš„ç¤ºä¾‹ï¼š

```js
const AdvancedError = errorEx('AdvancedError', {
    detail: {
        message: function (value, existingMessage) {
            return [`è¯¦ç»†ä¿¡æ¯: ${value}`, ...existingMessage];
        }
    }
});

const err = new AdvancedError('æœåŠ¡æœªå“åº”');
err.detail = 'æœåŠ¡å™¨å¯èƒ½æ­£åœ¨ç»´æŠ¤';
throw err;

/*
    AdvancedError: æœåŠ¡æœªå“åº”
    è¯¦ç»†ä¿¡æ¯: æœåŠ¡å™¨å¯èƒ½æ­£åœ¨ç»´æŠ¤
        at Object.<anonymous> (example.js:10:7)
*/
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º `AdvancedError` çš„é”™è¯¯ç±»å‹ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ äº†ä¸€ä¸ª `detail` å±æ€§ã€‚åœ¨è¿™ä¸ªå±æ€§ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå‡½æ•°æ¥å®šåˆ¶é”™è¯¯æ¶ˆæ¯ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ç°æœ‰çš„é”™è¯¯æ¶ˆæ¯ä¹‹å‰æ·»åŠ è‡ªå®šä¹‰çš„æ–‡æœ¬ã€‚

## ğŸ— æ€»ç»“

é€šè¿‡ä½¿ç”¨ `error-ex`ï¼Œä½ å¯ä»¥è½»æ¾åœ°å®ç°é”™è¯¯å¯¹è±¡çš„å®šåˆ¶åŒ–å’Œæ‰©å±•ï¼Œä¸ºä½ çš„ Node.js åº”ç”¨æ·»åŠ æ›´ä¸ºä¸°å¯Œå’Œè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•å’Œé”™è¯¯è¿½è¸ªã€‚

å¸Œæœ›é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œä½ å·²ç»æŒæ¡äº†å¦‚ä½•ä½¿ç”¨ `error-ex` æ¥åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯ç±»å‹ï¼Œå¹¶ä¸ºå…¶æ·»åŠ é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ›´åŠ æ·±å…¥åœ°è¿›è¡Œé”™è¯¯å¤„ç†ã€‚

> ä»“åº“åœ°å€ï¼šhttps://github.com/Qix-/node-error-ex