---
title: "向上搜索：如何在父目录中高效寻找文件与目录"
tags: ["Node.js", "文件系统", "find-up"]
desc: "深入探究find-up包，讲解如何在父目录树中便捷地定位所需文件和目录"
pkgName: "find-up"
---

# 向上搜索：如何在父目录中高效寻找文件与目录

在开发过程中，我们经常会遇到需要向上遍历文件系统去查找特定文件或目录的场景。`find-up` 是一个小巧但功能强大的 Node.js 包，它能帮助我们实现这一需求。本文将深入探究如何使用 `find-up` 进行有效搜索，并结合丰富的代码演示帮助大家快速掌握其用法。

## 🚀 安装 `find-up`

在开始使用 `find-up` 之前，我们首先需要通过 npm 将其安装到项目中。

```sh
npm install find-up
```

## 📘 使用示例

想像我们有如下文件结构：

```
/
└── Users
    └── sindresorhus
        ├── unicorn.png
        └── foo
            └── bar
                ├── baz
                └── example.js
```

接下来，我们将在 `example.js` 中展示一些 `find-up` 的使用示例。

### 查找单个文件

```javascript
import path from 'node:path';
import { findUp } from 'find-up';

async function findSingleFile() {
  const filePath = await findUp('unicorn.png');
  console.log(filePath);
  // 打印出找到的文件路径，若未找到则为 undefined
}

findSingleFile();
// 输出: /Users/sindresorhus/unicorn.png
```

### 按照优先级查找多个文件

```javascript
import { findUp } from 'find-up';

async function findFileByPriority() {
  const filePath = await findUp(['rainbow.png', 'unicorn.png']);
  console.log(filePath);
  // 如果 'unicorn.png' 存在将忽略 'rainbow.png'
  // 若两者都找不到则返回 undefined
}

findFileByPriority();
// 输出: /Users/sindresorhus/unicorn.png
```

### 自定义匹配逻辑

可以通过传递一个匹配函数来实现更复杂的搜索逻辑。

```javascript
import path from 'node:path';
import { findUp, pathExists } from 'find-up';

async function findWithCustomMatcher() {
  const dirPath = await findUp(async directory => {
    const hasUnicorns = await pathExists(path.join(directory, 'unicorn.png'));
    return hasUnicorns && directory;
  }, { type: 'directory' });

  console.log(dirPath);
  // 仅当文件夹中存在 'unicorn.png' 时返回路径
  // 否则返回 undefined
}

findWithCustomMatcher();
// 输出: /Users/sindresorhus
```

## 🛠 API 探究

`find-up` 提供了一系列 API，以适应不同的查找需求。

- `findUp(name, options?)`: 异步查找单个文件或目录。
- `findUp(matcher, options?)`: 使用自定义匹配函数异步进行查找。
- `findUpSync(name, options?)`: 同步查找单个文件或目录。
- `findUpSync(matcher, options?)`: 使用自定义匹配函数同步进行查找。
- 更多API请查看 `find-up` 文档。

### 🧭 使用 `findUpStop` 优化搜索性能

在某些情况下，你可能想要提前结束搜索以节省资源。你可以使用 `findUpStop` 符号来告诉 `find-up` 停止搜索。

```javascript
import path from 'node:path';
import { findUp, findUpStop } from 'find-up';

async function stopSearchEarly() {
  const filePath = await findUp(directory => {
    // 假设我们在 'work' 目录下不想继续搜寻 'logo.png'
    return path.basename(directory) === 'work' ? findUpStop : 'logo.png';
  });

  console.log(filePath);
  // 如果在 'work' 目录或其父目录找到 'logo.png'，则返回它的路径
  // 否则返回 undefined
}

stopSearchEarly();
// 输出: undefined (如果 'work' 目录下没有或其父目录没有找到 'logo.png')
```

在这个示例中，如果我们确认搜索已经到达了工作目录，就没有继续的必要了。这样我们可以有效减少不必要的搜索开销。

> 仓库地址：https://github.com/sindresorhus/find-up

随着以上的概览和示例，您现在应该对如何使用 `find-up` 包有了一个清晰的理解。它提供的 API 能够应对各种文件查找场景，并能与 Node.js 项目无缝整合。如果你的项目中需要这样的文件搜索功能，不妨试试看 `find-up`！